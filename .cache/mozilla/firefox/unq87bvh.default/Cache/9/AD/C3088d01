/*8ac81959fbc631de8b0f680257582552*/if(typeof AWS.DA!=="object"){AWS.DA={}}/*8e400b4959ae27efd7cf2a92acbce17e*/AWS.DA.Logic={ruleSets:{sitewide_page_load:{callType:"immediate",setters:[{eVar12:"{{aws-target-visitor-id}}"},{prop12:"{{eVar12}}"}]},house_ad_impression:{callType:"tl",linkType:"o",linkName:"House Ad Impressions",setters:[{eVar17:"{{this.attr(data-da-channel)}}|{{this.attr(data-da-language)}}|{{this.attr(data-da-campaign)}}|{{this.attr(data-da-placement)}}|{{this.attr(data-da-content)}}"},{prop17:"{{eVar17}}"},{events:"event10"},{eVar12:"{{aws-target-visitor-id}}"},{prop12:"{{eVar12}}"}]},house_ad_click:{callType:"tl",linkType:"o",linkName:"House Ad Clicks",setters:[{eVar18:"{{this.attr(data-da-channel)}}|{{this.attr(data-da-language)}}|{{this.attr(data-da-campaign)}}|{{this.attr(data-da-placement)}}|{{this.attr(data-da-content)}}"},{prop18:"{{eVar18}}"},{events:"event12"},{eVar24:"{{this.attr(data-da-channel)}}"},{prop24:"{{eVar24}}"},{eVar56:"{{this.attr(data-da-campaign)}}"},{prop56:"{{eVar56}}"},{eVar12:"{{aws-target-visitor-id}}"},{prop12:"{{eVar12}}"}]}},events:[{trigger:"viewport",selector:'.data-attr-wrapper[data-da-type="ha"]:not(div[data-da="carousel"] .data-attr-wrapper)',ruleSet:"house_ad_impression",optionSet:"IAB_standard_impression"},{trigger:"click",selector:'.data-attr-wrapper[data-da-type="ha"]',notSelector:'a[data-da="carousel-cta-box-cta-button"],a[data-da="vertical-buybox-cta-button"]',ruleSet:"house_ad_click"},{trigger:"custom",customEventName:"custom_aws-carousel_after-slide",selector:'.data-attr-wrapper[data-da-type="ha"]',ruleSet:"house_ad_impression",optionSet:"IAB_standard_impression",decorators:["noRepeatData","inViewport"]},{trigger:"pageBottom",ruleSet:"sitewide_page_load"}],optionSets:{IAB_standard_impression:{viewTime:1e3,viewPercentage:50}},aspects:{"aws-target-visitor-id":{type:"cookie",name:"aws-target-visitor-id",defaultValue:"",resolveTime:"pageBottom"}}};/*0826146fa96344481aefec43971ac0e4*/!function(){var DAError=function(){function DAError(msg){var err=new Error(msg);err.name="DAError";this.message=err.message;if(err.stack){this.stack=err.stack}}var err=new Error;err.name="DAError";DAError.prototype=err;return DAError}();AWS.DA.Error=DAError}();/*83e0aa530cb22beaa8473bf2f4f6746a*/!function(){var DA={};DA._DA={debounceWindowEvent:function(func,eventName,timeout,context){var that=context||this;var count=0;$(window).on(eventName,function(){var id=++count;window.setTimeout(function(){if(id===count){func.call(that)}},timeout)})},flattenArrayOfObjects:function(arr){var flattened={};for(var i=0,len=arr.length;i<len;i++){var obj=arr[i];for(var key in obj){if(obj.hasOwnProperty(key)){flattened[key]=obj[key]}}}return flattened},getRandomKey:function(){return(new Date).getTime()+Math.floor(Math.random()*999999)}};AWS.DA._DA=DA._DA}();/*cae133379b24ab99af006c1bb00a5708*/!function(){var DA={};DA.ElementUtils={isInViewport:function(top,height,viewPercentage,logger,$window){if(0>viewPercentage||viewPercentage>100){logger.error("Invalid range for 'viewPercentage'")}$window=$window||$(window);var viewportTop=$window.scrollTop();var viewportHeight=$window.height();var viewportBottom=viewportTop+viewportHeight;var bottom=top+height;var middleTop=top+height*viewPercentage/100;var middleBottom=top+height-height*viewPercentage/100;if(viewportTop<middleTop&&middleTop<viewportBottom&&viewportTop<top&&top<viewportBottom||viewportTop<middleBottom&&middleBottom<viewportBottom&&viewportTop<bottom&&bottom<viewportBottom||top<=viewportTop&&viewportBottom<=bottom){return true}return false},isReportableLink:function(url){if(typeof url!=="undefined"&&url!==null){if(url!==""&&!/^(\#|javascript)/.test(url)){return true}}return false},findSignificantInnerHeight:function($elem,level){var i,len;if(typeof level==="undefined"){level=0}var height=$elem.outerHeight();var maxLevels=5;if(level>=maxLevels){return height}if(height===0){var children=$elem.children();var heights=[];for(i=0,len=children.length;i<len;i++){heights[heights.length]=this.findSignificantInnerHeight.call(this,$(children[i]),level+1)}var largestHeight=0;for(i=0,len=heights.length;i<len;i++){largestHeight=largestHeight>heights[i]?largestHeight:heights[i]}return largestHeight}else{return height}}};AWS.DA.ElementUtils=DA.ElementUtils}();/*1622851ccf629b49d7d08d423568d496*/!function(){var DA={};DA.Decorators={};!function(){var signatureRegistry={};DA.Decorators.noRepeatData=function(event,$elem,logger){var name="noRepeatData";var dfd=$.Deferred();var onDone=function(){signatureRegistry[signature]=null};var signatureObj={data:$elem.data(),trigger:event.trigger,customEventName:event.customEventName,selector:event.selector,ruleSetKey:event.ruleSetKey};var signature=JSON.stringify(signatureObj);if(signatureRegistry.hasOwnProperty(signature)){logger.debug("FAIL "+name);dfd.reject()}else{logger.debug("PASS "+name);dfd.resolve(onDone)}return dfd}}();DA.Decorators.inViewport=function(event,$elem,logger,options){var name="inViewport";var dfd=$.Deferred();var top=$elem.offset().top;var height=AWS.DA.ElementUtils.findSignificantInnerHeight($elem);if(typeof options.viewPercentage!=="number"){options.viewPercentage=50}if(typeof options.viewTime!=="number"){options.viewTime=1e3}if(AWS.DA.ElementUtils.isInViewport(top,height,options.viewPercentage,logger)){logger.debug("Elem in viewport");setTimeout(function(){if(AWS.DA.ElementUtils.isInViewport(top,height,options.viewPercentage,logger)){logger.debug("Elem reached view time");logger.debug("PASS "+name);dfd.resolve()}else{logger.debug("Elem left viewport");logger.debug("FAIL "+name);dfd.reject()}},options.viewTime)}else{logger.debug("FAIL "+name);dfd.reject()}return dfd};AWS.DA.Decorators=DA.Decorators}();/*0adfd8bc97ab9e617ef2635713d64c2b*/!function(){var DA={};DA.Validator={validSetterKeyRegexp:new RegExp("^(eVar[0-9]{1,2}|prop[0-9]{1,2}|event[0-9]{1,2}|events)$"),validSVarRegexp:new RegExp("^(eVar[0-9]{1,2}|prop[0-9]{1,2}|event[0-9]{1,2}|events)$"),validLinkTrackVarListItemRegexp:new RegExp("^(eVar[0-9]{1,2}|prop[0-9]{1,2})$"),isValidSetterKey:function(str){return this.validSetterKeyRegexp.test(str)},isValidSVar:function(str){return this.validSVarRegexp.test(str)},isValidLinkTrackVarListItem:function(str){return this.validLinkTrackVarListItemRegexp.test(str)},validateSetters:function(setters,ruleSetName){if(!$.isArray(setters)){throw new AWS.DA.Error("'setters' in ruleSet '"+ruleSetName+"' must be an array")}for(var i=0,len=setters.length;i<len;i++){this.validateSetter(setters[i],ruleSetName)}},validateSetter:function(setter,ruleSetName){var key;var objsInSetter=0;for(key in setter){if(++objsInSetter>1){throw new AWS.DA.Error("More than 1 key in setter in ruleSet '"+ruleSetName+"'")}}if(!setter.hasOwnProperty(key)){throw new AWS.DA.Error("setter in ruleSet '"+ruleSetName+"' does not have any keys of its own")}if(!this.isValidSetterKey(key)){throw new AWS.DA.Error("Invalid setter key '"+key+"' in ruleSet '"+ruleSetName+"'")}}};AWS.DA.Validator=DA.Validator}();/*2b8bcb82cb92e46385d3a0ba6d54502f*//*!
 * aws-da-controller.js
 *
 * Copyright 2015, Amazon.com, Inc. or its affiliates. All rights reserved.
 */
!function(){var DA={};DA.Controller={logic:{},viewportQueue:{},trackerVarName:"s",isScrollWatchInitialized:false,resolvedAspects:{},validator:null,logger:null,init:function(validator,logger){this.validator=validator;this.logger=logger;this.setLoadTimeDebuggers();this.readExistingLogic();this.processLogic()},setLoadTimeDebuggers:function(){var that=this;$(document).ready(function(){that.logger.info("Saw document ready")});$(window).load(function(){that.logger.info("Saw window load")})},readExistingLogic:function(){if(typeof AWS.DA.Logic==="object"){this.logic=$.extend(true,{},AWS.DA.Logic);this.logger.debug("Logic: "+JSON.stringify(this.logic))}else{this.logger.error("No logic to read")}},updateLogic:function(logic){this.logic=$.extend(true,{},logic);this.logger.debug("Logic: "+JSON.stringify(this.logic))},processLogic:function(){this.processAspects();this.processEvents();this.processFunctions()},processAspects:function(){if(!this.logic.hasOwnProperty("aspects")){return}for(var key in this.logic.aspects){if(this.logic.aspects.hasOwnProperty(key)){this.resolveAspect(key,this.logic.aspects[key])}}},resolveAspect:function(key,aspect){var that=this;var resolve=function(){if(aspect.type==="cookie"){that.resolvedAspects[key]=that.resolveCookie(aspect)}};if(aspect.resolveTime==="pageBottom"){resolve()}else if(aspect.resolveTime==="domReady"){$(document).ready(function(){resolve()})}else if(aspect.resolveTime==="windowLoad"){$(window).load(function(){resolve()})}},resolveCookie:function(aspect){var val=$.cookie(aspect.name);if(typeof val==="undefined"||val===""){if(aspect.hasOwnProperty("defaultValue")){val=aspect.defaultValue}else{val=""}}return val},processEvents:function(){if(!this.logic.hasOwnProperty("events")){return}for(var i=0,len=this.logic.events.length;i<len;i++){var event=this.logic.events[i];var ruleSetKey=event.ruleSet;event.ruleSet=$.extend(true,{},this.logic.ruleSets[ruleSetKey]);event.ruleSet.key=ruleSetKey;if(event.hasOwnProperty("optionSet")){var optionSetKey=event.optionSet;var optionSet=$.extend(true,{},this.logic.optionSets[optionSetKey]);if(event.hasOwnProperty("options")){event.options=$.extend({},optionSet,event.options)}else{event.options=optionSet}}this.setupEvent(event)}},processFunctions:function(){if(!this.logic.hasOwnProperty("functions")){return}for(var i=0,len=this.logic.functions.length;i<len;i++){var fn=this.logic.functions[i];var ruleSetKey=this.logic.functions[i].ruleSet;fn.ruleSet=$.extend(true,{},this.logic.ruleSets[ruleSetKey]);fn.ruleSet.key=ruleSetKey;this.createCustomFunction(fn)}},setupEvent:function(event){var that=this;switch(event.trigger){case"click":$(document).ready(function(){that.setupSelectorBoundEvent(event)});break;case"viewport":$(document).ready(function(){that.setupViewportEvent(event)});break;case"pageBottom":this.setupPageLoadEvent(event);break;case"custom":$(document).ready(function(){that.setupCustomEvent(event)});break}},setupPageLoadEvent:function(event){this.logger.info("Preprocess event: "+JSON.stringify({trigger:event.trigger,ruleSetKey:event.ruleSet.key}));var ruleSet=$.extend(true,{},event.ruleSet);ruleSet.setters=this.preprocessSetters(ruleSet.setters);this.processRuleSet(ruleSet)},setupSelectorBoundEvent:function(event){var that=this;var elems=$(event.selector);for(var i=0,len=elems.length;i<len;i++){!function(i){var $elem=$(elems[i]);this.logger.info("Preprocess event: "+JSON.stringify({trigger:event.trigger,ruleSetKey:event.ruleSet.key,elem:$elem[0].toString(),className:$elem[0].className}));var ruleSet=$.extend(true,{},event.ruleSet);ruleSet.setters=this.preprocessSetters(ruleSet.setters,$elem);var cb=function(){that.processRuleSet(ruleSet)};if(event.trigger==="click"){this.setClickHandler($elem,event.notSelector,cb)}}.call(this,i)}},setupViewportEvent:function(event){var that=this;var elems=$(event.selector);for(var i=0,len=elems.length;i<len;i++){!function(i){var $elem=$(elems[i]);this.logger.info("Preprocess event: "+JSON.stringify({trigger:event.trigger,ruleSetKey:event.ruleSet.key,elem:$elem[0].toString(),className:$elem[0].className}));var ruleSet=$.extend(true,{},event.ruleSet);ruleSet.setters=this.preprocessSetters(ruleSet.setters,$elem);var cb=function(){that.processRuleSet(ruleSet)};this.viewportQueue[AWS.DA._DA.getRandomKey()]={$elem:$elem,locked:false,viewTime:event.options.viewTime,viewPercentage:event.options.viewPercentage,fn:cb}}.call(this,i)}if(!this.isScrollWatchInitialized){this.watchScroll()}setTimeout(function(){that.processViewportQueue()},800)},setupCustomEvent:function(event){var that=this;$(document).on(event.customEventName,function(e){that.logger.info("Saw event '"+event.customEventName+"'");var $elem=$(e.target);that.logger.info("Preprocess event: "+JSON.stringify({trigger:event.trigger,ruleSetKey:event.ruleSet.key,elem:$elem[0].toString(),className:$elem[0].className}));var ruleSet=$.extend(true,{},event.ruleSet);ruleSet.setters=that.preprocessSetters(ruleSet.setters,$elem);var cb=function(){that.processRuleSet(ruleSet)};that.runConditionChain(event,$elem,cb)})},runConditionChain:function(event,$elem,cb){this.logger.debug("Test conditions");if(typeof event.decorators!=="object"){event.decorators=[]}var delegateCondition=function(name,event,$elem,logger,options){logger.info("Test condition: "+name);return AWS.DA.Decorators[name](event,$elem,logger,options)};var dfds=[];for(var i=0,len=event.decorators.length;i<len;i++){dfds[dfds.length]=delegateCondition(event.decorators[i],event,$elem,this.logger,event.options)}$.when.apply(this,dfds).done(function(){for(var i=0,len=arguments.length;i<len;i++){if(typeof arguments[i]==="function"){arguments[i]()}}cb()}).fail(function(){for(var i=0,len=arguments.length;i<len;i++){if(typeof arguments[i]==="function"){arguments[i]()}}})},createCustomFunction:function(fn){if(typeof AWS.DA.fct!=="object"){AWS.DA.fct={}}var that=this;AWS.DA.fct[fn.name]=function($elem){if(typeof $elem!=="undefined"&&$elem instanceof jQuery&&$elem.length){this.logger.info("Execute function: "+JSON.stringify({name:fn.name,ruleSetKey:fn.ruleSet.key,elem:$elem[0].toString(),className:$elem[0].className}));var ruleSet=$.extend(true,{},fn.ruleSet);ruleSet.setters=that.preprocessSetters(ruleSet.setters,$elem);that.processRuleSet(ruleSet)}else{this.logger.error("Invalid or empty jQuery element passed to function: "+fn.name)}}},setClickHandler:function($elem,notSelector,cb){var that=this;$elem.on("click.aws-da",function(e){that.logger.debug("Clicked element");var $closestAnchor=$(e.target).closest("a");var isClosestAnchorWithinElem=!!$closestAnchor.parents($elem).length;if(isClosestAnchorWithinElem){var isClosestAnchorWithinIgnore=false;if(typeof notSelector!=="undefined"){isClosestAnchorWithinIgnore=!!$closestAnchor.closest(notSelector).parents($elem).length}if(!isClosestAnchorWithinIgnore){var clickUrl=$closestAnchor.attr("href");that.logger.debug("Anchor within element");if(AWS.DA.ElementUtils.isReportableLink(clickUrl)){that.logger.info("Report click");cb()}}else{that.logger.debug("Anchor within notSelector")}}})},preprocessSetters:function(setters,$elem){setters=this.resolveSetterLogic(setters,$elem);setters=this.syncSetters(setters);return setters},processRuleSet:function(ruleSet){this.logger.info("Process ruleSet: "+JSON.stringify({ruleSetKey:ruleSet.key}));ruleSet.setters=this.processSetters(ruleSet.setters);if(ruleSet.callType==="immediate"){this.setSVars(ruleSet.setters)}else{this.callLinkTrack(ruleSet.setters,ruleSet.callType,ruleSet.linkType,ruleSet.linkName)}},resolveSetterLogic:function(setters,$elem){this.logger.info("Resolve setter logic");setters=$.extend(true,[],setters);var resolvedValueRegistry={};for(var i=0,len=setters.length;i<len;i++){var setter=setters[i];var key;for(key in setter){if(setter.hasOwnProperty(key)){break}}var val=setter[key];var idxStack=this.findDynamicBlocksInSetter(val);var item,replacement;while(item=idxStack.pop()){if(resolvedValueRegistry.hasOwnProperty(item[2])){val=val.substr(0,item[0])+resolvedValueRegistry[item[2]]+val.substr(item[1]+1)}else{var match=item[2].match(/^this.attr\((.*?)\)$/);if(match!==null&&match.length>1&&typeof $elem!=="undefined"){var lastMatch=match[match.length-1];replacement=$elem.attr(lastMatch);if(typeof replacement==="undefined"){replacement=""}resolvedValueRegistry[item[2]]=replacement;val=val.substr(0,item[0])+replacement+val.substr(item[1]+1)}else{if(this.resolvedAspects.hasOwnProperty(item[2])){replacement=this.resolvedAspects[item[2]];if(typeof replacement==="undefined"){replacement=""}resolvedValueRegistry[item[2]]=replacement;val=val.substr(0,item[0])+replacement+val.substr(item[1]+1)}}}}setter[key]=val;this.logger.debug("'"+key+"' after replacement: "+val)}this.logger.debug("Logic-resolved setters: "+JSON.stringify(setters));return setters},syncSetters:function(setters,resolvedValueRegistry,level){setters=$.extend(true,[],setters);if(typeof level==="undefined"){level=0}if(typeof resolvedValueRegistry==="undefined"){resolvedValueRegistry={}}this.logger.debug("Sync setters at level: "+level);var hasNewlyResolved=false;for(var i=0,len=setters.length;i<len;i++){var setter=setters[i];var key;for(key in setter){if(setter.hasOwnProperty(key)){break}}var val=setter[key];var idxStack=this.findDynamicBlocksInSetter(val);if(idxStack.length===0){if(!resolvedValueRegistry.hasOwnProperty(key)){resolvedValueRegistry[key]=val;hasNewlyResolved=true;this.logger.debug("'"+key+"' resolved to: "+val)}}else{var item;while(item=idxStack.pop()){if(this.validator.isValidSVar(item[2])){if(resolvedValueRegistry.hasOwnProperty(item[2])){var replacement=resolvedValueRegistry[item[2]];val=val.substr(0,item[0])+replacement+val.substr(item[1]+1);this.logger.debug("'"+key+"' after replacement: "+val)}}}}setter[key]=val}if(hasNewlyResolved){return this.syncSetters.call(this,setters,resolvedValueRegistry,level+1)}else{this.logger.info("Synced setters: "+JSON.stringify(setters));return setters}},processSetters:function(setters){setters=$.extend(true,[],setters);var resolvedValueRegistry={};for(var i=0,len=setters.length;i<len;i++){var setter=setters[i];var key;for(key in setter){if(setter.hasOwnProperty(key)){break}}var val=setter[key];var idxStack=this.findDynamicBlocksInSetter(val);var item;while(item=idxStack.pop()){if(this.validator.isValidSVar(item[2])){var replacement="";if(resolvedValueRegistry.hasOwnProperty(item[2])){replacement=resolvedValueRegistry[item[2]]}else if(window[this.trackerVarName].hasOwnProperty(item[2])){replacement=window[this.trackerVarName][item[2]];resolvedValueRegistry[item[2]]=replacement}else{replacement="";resolvedValueRegistry[item[2]]=replacement;this.logger.warn("Could not resolve dynamic value: "+item[2])}val=val.substr(0,item[0])+replacement+val.substr(item[1]+1)}}resolvedValueRegistry[key]=val;setter[key]=val;this.logger.debug("'"+key+"' after replacement: "+val)}setters=AWS.DA._DA.flattenArrayOfObjects(setters);this.logger.info("Fully-processed setters: "+JSON.stringify(setters));return setters},findDynamicBlocksInSetter:function(val){var idxStack=[];var currentVal="";var inside=false;var lastCh="";var startIdx=0;for(var i=0,len=val.length;i<len;i++){var ch=val.charAt(i);if(ch===lastCh){if(ch==="{"){inside=true;startIdx=i-1}else if(ch==="}"){inside=false;idxStack[idxStack.length]=[startIdx,i,currentVal.substring(1,currentVal.length-1)];currentVal=""}}if(inside){currentVal+=ch}lastCh=ch}return idxStack},setSVars:function(obj){this.logger.info("Set s-vars: "+JSON.stringify(obj));for(var key in obj){if(obj.hasOwnProperty(key)){if(this.validator.isValidSVar(key)){window[this.trackerVarName][key]=obj[key]}}}},callLinkTrack:function(obj,callType,linkType,linkName){this.logger.debug("Call linkTrack");this.setSVars(obj);var linkTrackVars="";for(var key in obj){if(obj.hasOwnProperty(key)){if(this.validator.isValidLinkTrackVarListItem(key)){linkTrackVars+=key+","}}}// Remove trailing delimiter
linkTrackVars=linkTrackVars.replace(/,$/,"");window[this.trackerVarName].linkTrackVars=linkTrackVars;if(window[this.trackerVarName].events){window[this.trackerVarName].linkTrackEvents=window[this.trackerVarName].events}this.logger.info("linkTrackVars: "+window[this.trackerVarName].linkTrackVars.toString());this.logger.info("linkTrackEvents: "+window[this.trackerVarName].linkTrackEvents.toString());window[this.trackerVarName][callType](window[this.trackerVarName],linkType,linkName);this.logger.info("Called linkTrack");window[this.trackerVarName].linkTrackEvents="None"},watchScroll:function(){this.isScrollWatchInitialized=true;AWS.DA._DA.debounceWindowEvent(function(){this.processViewportQueue()},"scroll",40,this)},processViewportQueue:function(){this.logger.debug("Process viewport queue");var $window=$(window);for(var key in this.viewportQueue){if(this.viewportQueue.hasOwnProperty(key)){!function(key){var item=this.viewportQueue[key];if(!item.locked){item.top=item.$elem.offset().top;item.height=AWS.DA.ElementUtils.findSignificantInnerHeight(item.$elem);if(AWS.DA.ElementUtils.isInViewport(item.top,item.height,item.viewPercentage,this.logger,$window)){this.viewportQueue[key].locked=true;this.logger.debug("Elem in viewport");var that=this;setTimeout(function(){if(that.viewportQueue.hasOwnProperty(key)){if(AWS.DA.ElementUtils.isInViewport(item.top,item.height,item.viewPercentage,that.logger)){that.logger.debug("Elem reached view time");item.fn();delete that.viewportQueue[key]}else{that.viewportQueue[key].locked=false;that.logger.debug("Elem left viewport")}}},item.viewTime)}}}.call(this,key)}}}};DA.Controller.init(AWS.DA.Validator,new AWS.Logger("DA"));AWS.DA.Controller=DA.Controller}();